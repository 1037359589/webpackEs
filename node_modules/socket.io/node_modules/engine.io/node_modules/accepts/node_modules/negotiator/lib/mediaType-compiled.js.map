{"version":3,"sources":["mediaType.js"],"names":[],"mappings":"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","file":"mediaType-compiled.js","sourcesContent":["module.exports = preferredMediaTypes;\npreferredMediaTypes.preferredMediaTypes = preferredMediaTypes;\n\nfunction parseAccept(accept) {\n  return accept.split(',').map(function(e, i) {\n    return parseMediaType(e.trim(), i);\n  }).filter(function(e) {\n    return e;\n  });\n};\n\nfunction parseMediaType(s, i) {\n  var match = s.match(/\\s*(\\S+?)\\/([^;\\s]+)\\s*(?:;(.*))?/);\n  if (!match) return null;\n\n  var type = match[1],\n      subtype = match[2],\n      full = \"\" + type + \"/\" + subtype,\n      params = {},\n      q = 1;\n\n  if (match[3]) {\n    params = match[3].split(';').map(function(s) {\n      return s.trim().split('=');\n    }).reduce(function (set, p) {\n      set[p[0]] = p[1];\n      return set\n    }, params);\n\n    if (params.q != null) {\n      q = parseFloat(params.q);\n      delete params.q;\n    }\n  }\n\n  return {\n    type: type,\n    subtype: subtype,\n    params: params,\n    q: q,\n    i: i,\n    full: full\n  };\n}\n\nfunction getMediaTypePriority(type, accepted) {\n  return (accepted.map(function(a) {\n    return specify(type, a);\n  }).filter(Boolean).sort(function (a, b) {\n    if(a.s == b.s) {\n      return a.q > b.q ? -1 : 1;\n    } else {\n      return a.s > b.s ? -1 : 1;\n    }\n  })[0] || {s: 0, q: 0});\n}\n\nfunction specify(type, spec) {\n  var p = parseMediaType(type);\n  var s = 0;\n\n  if (!p) {\n    return null;\n  }\n\n  if(spec.type.toLowerCase() == p.type.toLowerCase()) {\n    s |= 4\n  } else if(spec.type != '*') {\n    return null;\n  }\n\n  if(spec.subtype.toLowerCase() == p.subtype.toLowerCase()) {\n    s |= 2\n  } else if(spec.subtype != '*') {\n    return null;\n  }\n\n  var keys = Object.keys(spec.params);\n  if (keys.length > 0) {\n    if (keys.every(function (k) {\n      return spec.params[k] == '*' || (spec.params[k] || '').toLowerCase() == (p.params[k] || '').toLowerCase();\n    })) {\n      s |= 1\n    } else {\n      return null\n    }\n  }\n\n  return {\n    q: spec.q,\n    s: s,\n  }\n\n}\n\nfunction preferredMediaTypes(accept, provided) {\n  // RFC 2616 sec 14.2: no header = */*\n  accept = parseAccept(accept === undefined ? '*/*' : accept || '');\n  if (provided) {\n    return provided.map(function(type) {\n      return [type, getMediaTypePriority(type, accept)];\n    }).filter(function(pair) {\n      return pair[1].q > 0;\n    }).sort(function(a, b) {\n      var pa = a[1];\n      var pb = b[1];\n      return (pb.q - pa.q) || (pb.s - pa.s) || (pa.i - pb.i);\n    }).map(function(pair) {\n      return pair[0];\n    });\n\n  } else {\n    return accept.sort(function (a, b) {\n      // revsort\n      return (b.q - a.q) || (a.i - b.i);\n    }).filter(function(type) {\n      return type.q > 0;\n    }).map(function(type) {\n      return type.full;\n    });\n  }\n}\n"]}