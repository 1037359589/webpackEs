{"version":3,"sources":["index.js"],"names":[],"mappings":"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","file":"index-compiled.js","sourcesContent":["'use strict';\n\nvar url = require('url');\n\nexports = module.exports = function historyApiFallback(options) {\n  options = options || {};\n  var logger = getLogger(options);\n\n  return function(req, res, next) {\n    var headers = req.headers;\n    if (req.method !== 'GET') {\n      logger(\n        'Not rewriting',\n        req.method,\n        req.url,\n        'because the method is not GET.'\n      );\n      return next();\n    } else if (!headers || typeof headers.accept !== 'string') {\n      logger(\n        'Not rewriting',\n        req.method,\n        req.url,\n        'because the client did not send an HTTP accept header.'\n      );\n      return next();\n    } else if (headers.accept.indexOf('application/json') === 0) {\n      logger(\n        'Not rewriting',\n        req.method,\n        req.url,\n        'because the client prefers JSON.'\n      );\n      return next();\n    } else if (!acceptsHtml(headers.accept)) {\n      logger(\n        'Not rewriting',\n        req.method,\n        req.url,\n        'because the client does not accept HTML.'\n      );\n      return next();\n    }\n\n    var parsedUrl = url.parse(req.url);\n    var rewriteTarget;\n    options.rewrites = options.rewrites || [];\n    for (var i = 0; i < options.rewrites.length; i++) {\n      var rewrite = options.rewrites[i];\n      var match = parsedUrl.pathname.match(rewrite.from);\n      if (match !== null) {\n        rewriteTarget = evaluateRewriteRule(parsedUrl, match, rewrite.to);\n        logger('Rewriting', req.method, req.url, 'to', rewriteTarget);\n        req.url = rewriteTarget;\n        return next();\n      }\n    }\n\n    if (parsedUrl.pathname.indexOf('.') !== -1) {\n      logger(\n        'Not rewriting',\n        req.method,\n        req.url,\n        'because the path includes a dot (.) character.'\n      );\n      return next();\n    }\n\n    rewriteTarget = options.index || '/index.html';\n    logger('Rewriting', req.method, req.url, 'to', rewriteTarget);\n    req.url = rewriteTarget;\n    next();\n  };\n};\n\nfunction evaluateRewriteRule(parsedUrl, match, rule) {\n  if (typeof rule === 'string') {\n    return rule;\n  } else if (typeof rule !== 'function') {\n    throw new Error('Rewrite rule can only be of type string of function.');\n  }\n\n  return rule({\n    parsedUrl: parsedUrl,\n    match: match\n  });\n}\n\nfunction acceptsHtml(header) {\n  return header.indexOf('text/html') !== -1 || header.indexOf('*/*') !== -1;\n}\n\nfunction getLogger(options) {\n  if (options && options.logger) {\n    return options.logger;\n  } else if (options && options.verbose) {\n    return console.log.bind(console);\n  }\n  return function(){};\n}\n"]}