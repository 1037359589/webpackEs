{"version":3,"sources":["iframe-bootstrap.js"],"names":[],"mappings":"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","file":"iframe-bootstrap-compiled.js","sourcesContent":["'use strict';\n\nvar urlUtils = require('./utils/url')\n  , eventUtils = require('./utils/event')\n  , JSON3 = require('json3')\n  , FacadeJS = require('./facade')\n  , InfoIframeReceiver = require('./info-iframe-receiver')\n  , iframeUtils = require('./utils/iframe')\n  , loc = require('./location')\n  ;\n\nvar debug = function() {};\nif (process.env.NODE_ENV !== 'production') {\n  debug = require('debug')('sockjs-client:iframe-bootstrap');\n}\n\nmodule.exports = function(SockJS, availableTransports) {\n  var transportMap = {};\n  availableTransports.forEach(function(at) {\n    if (at.facadeTransport) {\n      transportMap[at.facadeTransport.transportName] = at.facadeTransport;\n    }\n  });\n\n  // hard-coded for the info iframe\n  // TODO see if we can make this more dynamic\n  transportMap[InfoIframeReceiver.transportName] = InfoIframeReceiver;\n  var parentOrigin;\n\n  /* eslint-disable camelcase */\n  SockJS.bootstrap_iframe = function() {\n    /* eslint-enable camelcase */\n    var facade;\n    iframeUtils.currentWindowId = loc.hash.slice(1);\n    var onMessage = function(e) {\n      if (e.source !== parent) {\n        return;\n      }\n      if (typeof parentOrigin === 'undefined') {\n        parentOrigin = e.origin;\n      }\n      if (e.origin !== parentOrigin) {\n        return;\n      }\n\n      var iframeMessage;\n      try {\n        iframeMessage = JSON3.parse(e.data);\n      } catch (ignored) {\n        debug('bad json', e.data);\n        return;\n      }\n\n      if (iframeMessage.windowId !== iframeUtils.currentWindowId) {\n        return;\n      }\n      switch (iframeMessage.type) {\n      case 's':\n        var p;\n        try {\n          p = JSON3.parse(iframeMessage.data);\n        } catch (ignored) {\n          debug('bad json', iframeMessage.data);\n          break;\n        }\n        var version = p[0];\n        var transport = p[1];\n        var transUrl = p[2];\n        var baseUrl = p[3];\n        debug(version, transport, transUrl, baseUrl);\n        // change this to semver logic\n        if (version !== SockJS.version) {\n          throw new Error('Incompatibile SockJS! Main site uses:' +\n                    ' \"' + version + '\", the iframe:' +\n                    ' \"' + SockJS.version + '\".');\n        }\n\n        if (!urlUtils.isOriginEqual(transUrl, loc.href) ||\n            !urlUtils.isOriginEqual(baseUrl, loc.href)) {\n          throw new Error('Can\\'t connect to different domain from within an ' +\n                    'iframe. (' + loc.href + ', ' + transUrl + ', ' + baseUrl + ')');\n        }\n        facade = new FacadeJS(new transportMap[transport](transUrl, baseUrl));\n        break;\n      case 'm':\n        facade._send(iframeMessage.data);\n        break;\n      case 'c':\n        if (facade) {\n          facade._close();\n        }\n        facade = null;\n        break;\n      }\n    };\n\n    eventUtils.attachEvent('message', onMessage);\n\n    // Start\n    iframeUtils.postMessage('s');\n  };\n};\n"]}