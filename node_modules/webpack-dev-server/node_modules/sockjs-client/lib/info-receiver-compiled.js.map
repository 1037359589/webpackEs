{"version":3,"sources":["info-receiver.js"],"names":[],"mappings":"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","file":"info-receiver-compiled.js","sourcesContent":["'use strict';\n\nvar EventEmitter = require('events').EventEmitter\n  , inherits = require('inherits')\n  , urlUtils = require('./utils/url')\n  , XDR = require('./transport/sender/xdr')\n  , XHRCors = require('./transport/sender/xhr-cors')\n  , XHRLocal = require('./transport/sender/xhr-local')\n  , XHRFake = require('./transport/sender/xhr-fake')\n  , InfoIframe = require('./info-iframe')\n  , InfoAjax = require('./info-ajax')\n  ;\n\nvar debug = function() {};\nif (process.env.NODE_ENV !== 'production') {\n  debug = require('debug')('sockjs-client:info-receiver');\n}\n\nfunction InfoReceiver(baseUrl, urlInfo) {\n  debug(baseUrl);\n  var self = this;\n  EventEmitter.call(this);\n\n  setTimeout(function() {\n    self.doXhr(baseUrl, urlInfo);\n  }, 0);\n}\n\ninherits(InfoReceiver, EventEmitter);\n\n// TODO this is currently ignoring the list of available transports and the whitelist\n\nInfoReceiver._getReceiver = function(baseUrl, url, urlInfo) {\n  // determine method of CORS support (if needed)\n  if (urlInfo.sameOrigin) {\n    return new InfoAjax(url, XHRLocal);\n  }\n  if (XHRCors.enabled) {\n    return new InfoAjax(url, XHRCors);\n  }\n  if (XDR.enabled && urlInfo.sameScheme) {\n    return new InfoAjax(url, XDR);\n  }\n  if (InfoIframe.enabled()) {\n    return new InfoIframe(baseUrl, url);\n  }\n  return new InfoAjax(url, XHRFake);\n};\n\nInfoReceiver.prototype.doXhr = function(baseUrl, urlInfo) {\n  var self = this\n    , url = urlUtils.addPath(baseUrl, '/info')\n    ;\n  debug('doXhr', url);\n\n  this.xo = InfoReceiver._getReceiver(baseUrl, url, urlInfo);\n\n  this.timeoutRef = setTimeout(function() {\n    debug('timeout');\n    self._cleanup(false);\n    self.emit('finish');\n  }, InfoReceiver.timeout);\n\n  this.xo.once('finish', function(info, rtt) {\n    debug('finish', info, rtt);\n    self._cleanup(true);\n    self.emit('finish', info, rtt);\n  });\n};\n\nInfoReceiver.prototype._cleanup = function(wasClean) {\n  debug('_cleanup');\n  clearTimeout(this.timeoutRef);\n  this.timeoutRef = null;\n  if (!wasClean && this.xo) {\n    this.xo.close();\n  }\n  this.xo = null;\n};\n\nInfoReceiver.prototype.close = function() {\n  debug('close');\n  this.removeAllListeners();\n  this._cleanup(false);\n};\n\nInfoReceiver.timeout = 8000;\n\nmodule.exports = InfoReceiver;\n"]}