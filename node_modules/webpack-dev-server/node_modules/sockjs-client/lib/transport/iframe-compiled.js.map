{"version":3,"sources":["iframe.js"],"names":[],"mappings":"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","file":"iframe-compiled.js","sourcesContent":["'use strict';\n\n// Few cool transports do work only for same-origin. In order to make\n// them work cross-domain we shall use iframe, served from the\n// remote domain. New browsers have capabilities to communicate with\n// cross domain iframe using postMessage(). In IE it was implemented\n// from IE 8+, but of course, IE got some details wrong:\n//    http://msdn.microsoft.com/en-us/library/cc197015(v=VS.85).aspx\n//    http://stevesouders.com/misc/test-postmessage.php\n\nvar inherits = require('inherits')\n  , JSON3 = require('json3')\n  , EventEmitter = require('events').EventEmitter\n  , version = require('../version')\n  , urlUtils = require('../utils/url')\n  , iframeUtils = require('../utils/iframe')\n  , eventUtils = require('../utils/event')\n  , random = require('../utils/random')\n  ;\n\nvar debug = function() {};\nif (process.env.NODE_ENV !== 'production') {\n  debug = require('debug')('sockjs-client:transport:iframe');\n}\n\nfunction IframeTransport(transport, transUrl, baseUrl) {\n  if (!IframeTransport.enabled()) {\n    throw new Error('Transport created when disabled');\n  }\n  EventEmitter.call(this);\n\n  var self = this;\n  this.origin = urlUtils.getOrigin(baseUrl);\n  this.baseUrl = baseUrl;\n  this.transUrl = transUrl;\n  this.transport = transport;\n  this.windowId = random.string(8);\n\n  var iframeUrl = urlUtils.addPath(baseUrl, '/iframe.html') + '#' + this.windowId;\n  debug(transport, transUrl, iframeUrl);\n\n  this.iframeObj = iframeUtils.createIframe(iframeUrl, function(r) {\n    debug('err callback');\n    self.emit('close', 1006, 'Unable to load an iframe (' + r + ')');\n    self.close();\n  });\n\n  this.onmessageCallback = this._message.bind(this);\n  eventUtils.attachEvent('message', this.onmessageCallback);\n}\n\ninherits(IframeTransport, EventEmitter);\n\nIframeTransport.prototype.close = function() {\n  debug('close');\n  this.removeAllListeners();\n  if (this.iframeObj) {\n    eventUtils.detachEvent('message', this.onmessageCallback);\n    try {\n      // When the iframe is not loaded, IE raises an exception\n      // on 'contentWindow'.\n      this.postMessage('c');\n    } catch (x) {}\n    this.iframeObj.cleanup();\n    this.iframeObj = null;\n    this.onmessageCallback = this.iframeObj = null;\n  }\n};\n\nIframeTransport.prototype._message = function(e) {\n  debug('message', e.data);\n  if (!urlUtils.isOriginEqual(e.origin, this.origin)) {\n    debug('not same origin', e.origin, this.origin);\n    return;\n  }\n\n  var iframeMessage;\n  try {\n    iframeMessage = JSON3.parse(e.data);\n  } catch (ignored) {\n    debug('bad json', e.data);\n    return;\n  }\n\n  if (iframeMessage.windowId !== this.windowId) {\n    debug('mismatched window id', iframeMessage.windowId, this.windowId);\n    return;\n  }\n\n  switch (iframeMessage.type) {\n  case 's':\n    this.iframeObj.loaded();\n    // window global dependency\n    this.postMessage('s', JSON3.stringify([\n      version\n    , this.transport\n    , this.transUrl\n    , this.baseUrl\n    ]));\n    break;\n  case 't':\n    this.emit('message', iframeMessage.data);\n    break;\n  case 'c':\n    var cdata;\n    try {\n      cdata = JSON3.parse(iframeMessage.data);\n    } catch (ignored) {\n      debug('bad json', iframeMessage.data);\n      return;\n    }\n    this.emit('close', cdata[0], cdata[1]);\n    this.close();\n    break;\n  }\n};\n\nIframeTransport.prototype.postMessage = function(type, data) {\n  debug('postMessage', type, data);\n  this.iframeObj.post(JSON3.stringify({\n    windowId: this.windowId\n  , type: type\n  , data: data || ''\n  }), this.origin);\n};\n\nIframeTransport.prototype.send = function(message) {\n  debug('send', message);\n  this.postMessage('m', message);\n};\n\nIframeTransport.enabled = function() {\n  return iframeUtils.iframeEnabled;\n};\n\nIframeTransport.transportName = 'iframe';\nIframeTransport.roundTrips = 2;\n\nmodule.exports = IframeTransport;\n"]}