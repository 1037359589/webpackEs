{"version":3,"sources":["eventsource.js"],"names":[],"mappings":"AAAA,YAAY,CAAC;;AAEb,IAAI,QAAQ,GAAG,OAAO,CAAC,UAAU,CAAC;IAC9B,YAAY,GAAG,OAAO,CAAC,QAAQ,CAAC,CAAC,YAAY;IAC7C,iBAAiB,GAAG,OAAO,CAAC,aAAa,CAAC,CAC3C;;AAEH,IAAI,KAAK,GAAG,YAAW,EAAE,CAAC;AAC1B,IAAI,OAAO,CAAC,GAAG,CAAC,QAAQ,KAAK,YAAY,EAAE;AACzC,OAAK,GAAG,OAAO,CAAC,OAAO,CAAC,CAAC,oCAAoC,CAAC,CAAC;CAChE;;AAED,SAAS,mBAAmB,CAAC,GAAG,EAAE;AAChC,OAAK,CAAC,GAAG,CAAC,CAAC;AACX,cAAY,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;;AAExB,MAAI,IAAI,GAAG,IAAI,CAAC;AAChB,MAAI,EAAE,GAAG,IAAI,CAAC,EAAE,GAAG,IAAI,iBAAiB,CAAC,GAAG,CAAC,CAAC;AAC9C,IAAE,CAAC,SAAS,GAAG,UAAS,CAAC,EAAE;AACzB,SAAK,CAAC,SAAS,EAAE,CAAC,CAAC,IAAI,CAAC,CAAC;AACzB,QAAI,CAAC,IAAI,CAAC,SAAS,EAAE,SAAS,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC;GACzC,CAAC;AACF,IAAE,CAAC,OAAO,GAAG,UAAS,CAAC,EAAE;AACvB,SAAK,CAAC,OAAO,EAAE,EAAE,CAAC,UAAU,EAAE,CAAC,CAAC;;;AAAC,AAGjC,QAAI,MAAM,GAAI,EAAE,CAAC,UAAU,KAAK,CAAC,GAAG,SAAS,GAAG,WAAW,AAAC,CAAC;AAC7D,QAAI,CAAC,QAAQ,EAAE,CAAC;AAChB,QAAI,CAAC,MAAM,CAAC,MAAM,CAAC,CAAC;GACrB,CAAC;CACH;;AAED,QAAQ,CAAC,mBAAmB,EAAE,YAAY,CAAC,CAAC;;AAE5C,mBAAmB,CAAC,SAAS,CAAC,KAAK,GAAG,YAAW;AAC/C,OAAK,CAAC,OAAO,CAAC,CAAC;AACf,MAAI,CAAC,QAAQ,EAAE,CAAC;AAChB,MAAI,CAAC,MAAM,CAAC,MAAM,CAAC,CAAC;CACrB,CAAC;;AAEF,mBAAmB,CAAC,SAAS,CAAC,QAAQ,GAAG,YAAW;AAClD,OAAK,CAAC,SAAS,CAAC,CAAC;AACjB,MAAI,EAAE,GAAG,IAAI,CAAC,EAAE,CAAC;AACjB,MAAI,EAAE,EAAE;AACN,MAAE,CAAC,SAAS,GAAG,EAAE,CAAC,OAAO,GAAG,IAAI,CAAC;AACjC,MAAE,CAAC,KAAK,EAAE,CAAC;AACX,QAAI,CAAC,EAAE,GAAG,IAAI,CAAC;GAChB;CACF,CAAC;;AAEF,mBAAmB,CAAC,SAAS,CAAC,MAAM,GAAG,UAAS,MAAM,EAAE;AACtD,OAAK,CAAC,OAAO,EAAE,MAAM,CAAC,CAAC;AACvB,MAAI,IAAI,GAAG,IAAI;;;;AAAC,AAIhB,YAAU,CAAC,YAAW;AACpB,QAAI,CAAC,IAAI,CAAC,OAAO,EAAE,IAAI,EAAE,MAAM,CAAC,CAAC;AACjC,QAAI,CAAC,kBAAkB,EAAE,CAAC;GAC3B,EAAE,GAAG,CAAC,CAAC;CACT,CAAC;;AAEF,MAAM,CAAC,OAAO,GAAG,mBAAmB,CAAC","file":"eventsource-compiled.js","sourcesContent":["'use strict';\n\nvar inherits = require('inherits')\n  , EventEmitter = require('events').EventEmitter\n  , EventSourceDriver = require('eventsource')\n  ;\n\nvar debug = function() {};\nif (process.env.NODE_ENV !== 'production') {\n  debug = require('debug')('sockjs-client:receiver:eventsource');\n}\n\nfunction EventSourceReceiver(url) {\n  debug(url);\n  EventEmitter.call(this);\n\n  var self = this;\n  var es = this.es = new EventSourceDriver(url);\n  es.onmessage = function(e) {\n    debug('message', e.data);\n    self.emit('message', decodeURI(e.data));\n  };\n  es.onerror = function(e) {\n    debug('error', es.readyState, e);\n    // ES on reconnection has readyState = 0 or 1.\n    // on network error it's CLOSED = 2\n    var reason = (es.readyState !== 2 ? 'network' : 'permanent');\n    self._cleanup();\n    self._close(reason);\n  };\n}\n\ninherits(EventSourceReceiver, EventEmitter);\n\nEventSourceReceiver.prototype.abort = function() {\n  debug('abort');\n  this._cleanup();\n  this._close('user');\n};\n\nEventSourceReceiver.prototype._cleanup = function() {\n  debug('cleanup');\n  var es = this.es;\n  if (es) {\n    es.onmessage = es.onerror = null;\n    es.close();\n    this.es = null;\n  }\n};\n\nEventSourceReceiver.prototype._close = function(reason) {\n  debug('close', reason);\n  var self = this;\n  // Safari and chrome < 15 crash if we close window before\n  // waiting for ES cleanup. See:\n  // https://code.google.com/p/chromium/issues/detail?id=89155\n  setTimeout(function() {\n    self.emit('close', null, reason);\n    self.removeAllListeners();\n  }, 200);\n};\n\nmodule.exports = EventSourceReceiver;\n"]}