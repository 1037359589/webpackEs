{"version":3,"sources":["htmlfile.js"],"names":[],"mappings":"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","file":"htmlfile-compiled.js","sourcesContent":["'use strict';\n\nvar inherits = require('inherits')\n  , iframeUtils = require('../../utils/iframe')\n  , urlUtils = require('../../utils/url')\n  , EventEmitter = require('events').EventEmitter\n  , random = require('../../utils/random')\n  ;\n\nvar debug = function() {};\nif (process.env.NODE_ENV !== 'production') {\n  debug = require('debug')('sockjs-client:receiver:htmlfile');\n}\n\nfunction HtmlfileReceiver(url) {\n  debug(url);\n  EventEmitter.call(this);\n  var self = this;\n  iframeUtils.polluteGlobalNamespace();\n\n  this.id = 'a' + random.string(6);\n  url = urlUtils.addQuery(url, 'c=' + decodeURIComponent(iframeUtils.WPrefix + '.' + this.id));\n\n  debug('using htmlfile', HtmlfileReceiver.htmlfileEnabled);\n  var constructFunc = HtmlfileReceiver.htmlfileEnabled ?\n      iframeUtils.createHtmlfile : iframeUtils.createIframe;\n\n  global[iframeUtils.WPrefix][this.id] = {\n    start: function() {\n      debug('start');\n      self.iframeObj.loaded();\n    }\n  , message: function(data) {\n      debug('message', data);\n      self.emit('message', data);\n    }\n  , stop: function() {\n      debug('stop');\n      self._cleanup();\n      self._close('network');\n    }\n  };\n  this.iframeObj = constructFunc(url, function() {\n    debug('callback');\n    self._cleanup();\n    self._close('permanent');\n  });\n}\n\ninherits(HtmlfileReceiver, EventEmitter);\n\nHtmlfileReceiver.prototype.abort = function() {\n  debug('abort');\n  this._cleanup();\n  this._close('user');\n};\n\nHtmlfileReceiver.prototype._cleanup = function() {\n  debug('_cleanup');\n  if (this.iframeObj) {\n    this.iframeObj.cleanup();\n    this.iframeObj = null;\n  }\n  delete global[iframeUtils.WPrefix][this.id];\n};\n\nHtmlfileReceiver.prototype._close = function(reason) {\n  debug('_close', reason);\n  this.emit('close', null, reason);\n  this.removeAllListeners();\n};\n\nHtmlfileReceiver.htmlfileEnabled = false;\n\n// obfuscate to avoid firewalls\nvar axo = ['Active'].concat('Object').join('X');\nif (axo in global) {\n  try {\n    HtmlfileReceiver.htmlfileEnabled = !!new global[axo]('htmlfile');\n  } catch (x) {}\n}\n\nHtmlfileReceiver.enabled = HtmlfileReceiver.htmlfileEnabled || iframeUtils.iframeEnabled;\n\nmodule.exports = HtmlfileReceiver;\n"]}