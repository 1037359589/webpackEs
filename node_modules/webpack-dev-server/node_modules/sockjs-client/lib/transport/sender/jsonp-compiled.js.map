{"version":3,"sources":["jsonp.js"],"names":[],"mappings":"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","file":"jsonp-compiled.js","sourcesContent":["'use strict';\n\nvar random = require('../../utils/random')\n  , urlUtils = require('../../utils/url')\n  ;\n\nvar debug = function() {};\nif (process.env.NODE_ENV !== 'production') {\n  debug = require('debug')('sockjs-client:sender:jsonp');\n}\n\nvar form, area;\n\nfunction createIframe(id) {\n  debug('createIframe', id);\n  try {\n    // ie6 dynamic iframes with target=\"\" support (thanks Chris Lambacher)\n    return global.document.createElement('<iframe name=\"' + id + '\">');\n  } catch (x) {\n    var iframe = global.document.createElement('iframe');\n    iframe.name = id;\n    return iframe;\n  }\n}\n\nfunction createForm() {\n  debug('createForm');\n  form = global.document.createElement('form');\n  form.style.display = 'none';\n  form.style.position = 'absolute';\n  form.method = 'POST';\n  form.enctype = 'application/x-www-form-urlencoded';\n  form.acceptCharset = 'UTF-8';\n\n  area = global.document.createElement('textarea');\n  area.name = 'd';\n  form.appendChild(area);\n\n  global.document.body.appendChild(form);\n}\n\nmodule.exports = function(url, payload, callback) {\n  debug(url, payload);\n  if (!form) {\n    createForm();\n  }\n  var id = 'a' + random.string(8);\n  form.target = id;\n  form.action = urlUtils.addQuery(urlUtils.addPath(url, '/jsonp_send'), 'i=' + id);\n\n  var iframe = createIframe(id);\n  iframe.id = id;\n  iframe.style.display = 'none';\n  form.appendChild(iframe);\n\n  try {\n    area.value = payload;\n  } catch (e) {\n    // seriously broken browsers get here\n  }\n  form.submit();\n\n  var completed = function(err) {\n    debug('completed', id, err);\n    if (!iframe.onerror) {\n      return;\n    }\n    iframe.onreadystatechange = iframe.onerror = iframe.onload = null;\n    // Opera mini doesn't like if we GC iframe\n    // immediately, thus this timeout.\n    setTimeout(function() {\n      debug('cleaning up', id);\n      iframe.parentNode.removeChild(iframe);\n      iframe = null;\n    }, 500);\n    area.value = '';\n    // It is not possible to detect if the iframe succeeded or\n    // failed to submit our form.\n    callback(err);\n  };\n  iframe.onerror = function() {\n    debug('onerror', id);\n    completed();\n  };\n  iframe.onload = function() {\n    debug('onload', id);\n    completed();\n  };\n  iframe.onreadystatechange = function(e) {\n    debug('onreadystatechange', id, iframe.readyState, e);\n    if (iframe.readyState === 'complete') {\n      completed();\n    }\n  };\n  return function() {\n    debug('aborted', id);\n    completed(new Error('Aborted'));\n  };\n};\n"]}