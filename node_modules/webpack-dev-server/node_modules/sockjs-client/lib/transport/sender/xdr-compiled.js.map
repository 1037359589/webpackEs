{"version":3,"sources":["xdr.js"],"names":[],"mappings":"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","file":"xdr-compiled.js","sourcesContent":["'use strict';\n\nvar EventEmitter = require('events').EventEmitter\n  , inherits = require('inherits')\n  , eventUtils = require('../../utils/event')\n  , browser = require('../../utils/browser')\n  , urlUtils = require('../../utils/url')\n  ;\n\nvar debug = function() {};\nif (process.env.NODE_ENV !== 'production') {\n  debug = require('debug')('sockjs-client:sender:xdr');\n}\n\n// References:\n//   http://ajaxian.com/archives/100-line-ajax-wrapper\n//   http://msdn.microsoft.com/en-us/library/cc288060(v=VS.85).aspx\n\nfunction XDRObject(method, url, payload) {\n  debug(method, url);\n  var self = this;\n  EventEmitter.call(this);\n\n  setTimeout(function() {\n    self._start(method, url, payload);\n  }, 0);\n}\n\ninherits(XDRObject, EventEmitter);\n\nXDRObject.prototype._start = function(method, url, payload) {\n  debug('_start');\n  var self = this;\n  var xdr = new global.XDomainRequest();\n  // IE caches even POSTs\n  url = urlUtils.addQuery(url, 't=' + (+new Date()));\n\n  xdr.onerror = function() {\n    debug('onerror');\n    self._error();\n  };\n  xdr.ontimeout = function() {\n    debug('ontimeout');\n    self._error();\n  };\n  xdr.onprogress = function() {\n    debug('progress', xdr.responseText);\n    self.emit('chunk', 200, xdr.responseText);\n  };\n  xdr.onload = function() {\n    debug('load');\n    self.emit('finish', 200, xdr.responseText);\n    self._cleanup(false);\n  };\n  this.xdr = xdr;\n  this.unloadRef = eventUtils.unloadAdd(function() {\n    self._cleanup(true);\n  });\n  try {\n    // Fails with AccessDenied if port number is bogus\n    this.xdr.open(method, url);\n    if (this.timeout) {\n      this.xdr.timeout = this.timeout;\n    }\n    this.xdr.send(payload);\n  } catch (x) {\n    this._error();\n  }\n};\n\nXDRObject.prototype._error = function() {\n  this.emit('finish', 0, '');\n  this._cleanup(false);\n};\n\nXDRObject.prototype._cleanup = function(abort) {\n  debug('cleanup', abort);\n  if (!this.xdr) {\n    return;\n  }\n  this.removeAllListeners();\n  eventUtils.unloadDel(this.unloadRef);\n\n  this.xdr.ontimeout = this.xdr.onerror = this.xdr.onprogress = this.xdr.onload = null;\n  if (abort) {\n    try {\n      this.xdr.abort();\n    } catch (x) {}\n  }\n  this.unloadRef = this.xdr = null;\n};\n\nXDRObject.prototype.close = function() {\n  debug('close');\n  this._cleanup(true);\n};\n\n// IE 8/9 if the request target uses the same scheme - #79\nXDRObject.enabled = !!(global.XDomainRequest && browser.hasDomain());\n\nmodule.exports = XDRObject;\n"]}