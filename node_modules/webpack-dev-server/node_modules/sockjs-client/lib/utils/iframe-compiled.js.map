{"version":3,"sources":["iframe.js"],"names":[],"mappings":"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","file":"iframe-compiled.js","sourcesContent":["'use strict';\n\nvar eventUtils = require('./event')\n  , JSON3 = require('json3')\n  , browser = require('./browser')\n  ;\n\nvar debug = function() {};\nif (process.env.NODE_ENV !== 'production') {\n  debug = require('debug')('sockjs-client:utils:iframe');\n}\n\nmodule.exports = {\n  WPrefix: '_jp'\n, currentWindowId: null\n\n, polluteGlobalNamespace: function() {\n    if (!(module.exports.WPrefix in global)) {\n      global[module.exports.WPrefix] = {};\n    }\n  }\n\n, postMessage: function(type, data) {\n    if (global.parent !== global) {\n      global.parent.postMessage(JSON3.stringify({\n        windowId: module.exports.currentWindowId\n      , type: type\n      , data: data || ''\n      }), '*');\n    } else {\n      debug('Cannot postMessage, no parent window.', type, data);\n    }\n  }\n\n, createIframe: function(iframeUrl, errorCallback) {\n    var iframe = global.document.createElement('iframe');\n    var tref, unloadRef;\n    var unattach = function() {\n      debug('unattach');\n      clearTimeout(tref);\n      // Explorer had problems with that.\n      try {\n        iframe.onload = null;\n      } catch (x) {}\n      iframe.onerror = null;\n    };\n    var cleanup = function() {\n      debug('cleanup');\n      if (iframe) {\n        unattach();\n        // This timeout makes chrome fire onbeforeunload event\n        // within iframe. Without the timeout it goes straight to\n        // onunload.\n        setTimeout(function() {\n          if (iframe) {\n            iframe.parentNode.removeChild(iframe);\n          }\n          iframe = null;\n        }, 0);\n        eventUtils.unloadDel(unloadRef);\n      }\n    };\n    var onerror = function(err) {\n      debug('onerror', err);\n      if (iframe) {\n        cleanup();\n        errorCallback(err);\n      }\n    };\n    var post = function(msg, origin) {\n      debug('post', msg, origin);\n      try {\n        // When the iframe is not loaded, IE raises an exception\n        // on 'contentWindow'.\n        setTimeout(function() {\n          if (iframe && iframe.contentWindow) {\n            iframe.contentWindow.postMessage(msg, origin);\n          }\n        }, 0);\n      } catch (x) {}\n    };\n\n    iframe.src = iframeUrl;\n    iframe.style.display = 'none';\n    iframe.style.position = 'absolute';\n    iframe.onerror = function() {\n      onerror('onerror');\n    };\n    iframe.onload = function() {\n      debug('onload');\n      // `onload` is triggered before scripts on the iframe are\n      // executed. Give it few seconds to actually load stuff.\n      clearTimeout(tref);\n      tref = setTimeout(function() {\n        onerror('onload timeout');\n      }, 2000);\n    };\n    global.document.body.appendChild(iframe);\n    tref = setTimeout(function() {\n      onerror('timeout');\n    }, 15000);\n    unloadRef = eventUtils.unloadAdd(cleanup);\n    return {\n      post: post\n    , cleanup: cleanup\n    , loaded: unattach\n    };\n  }\n\n/* jshint undef: false, newcap: false */\n/* eslint no-undef: 0, new-cap: 0 */\n, createHtmlfile: function(iframeUrl, errorCallback) {\n    var axo = ['Active'].concat('Object').join('X');\n    var doc = new global[axo]('htmlfile');\n    var tref, unloadRef;\n    var iframe;\n    var unattach = function() {\n      clearTimeout(tref);\n      iframe.onerror = null;\n    };\n    var cleanup = function() {\n      if (doc) {\n        unattach();\n        eventUtils.unloadDel(unloadRef);\n        iframe.parentNode.removeChild(iframe);\n        iframe = doc = null;\n        CollectGarbage();\n      }\n    };\n    var onerror = function(r)  {\n      debug('onerror', r);\n      if (doc) {\n        cleanup();\n        errorCallback(r);\n      }\n    };\n    var post = function(msg, origin) {\n      try {\n        // When the iframe is not loaded, IE raises an exception\n        // on 'contentWindow'.\n        setTimeout(function() {\n          if (iframe && iframe.contentWindow) {\n              iframe.contentWindow.postMessage(msg, origin);\n          }\n        }, 0);\n      } catch (x) {}\n    };\n\n    doc.open();\n    doc.write('<html><s' + 'cript>' +\n              'document.domain=\"' + global.document.domain + '\";' +\n              '</s' + 'cript></html>');\n    doc.close();\n    doc.parentWindow[module.exports.WPrefix] = global[module.exports.WPrefix];\n    var c = doc.createElement('div');\n    doc.body.appendChild(c);\n    iframe = doc.createElement('iframe');\n    c.appendChild(iframe);\n    iframe.src = iframeUrl;\n    iframe.onerror = function() {\n      onerror('onerror');\n    };\n    tref = setTimeout(function() {\n      onerror('timeout');\n    }, 15000);\n    unloadRef = eventUtils.unloadAdd(cleanup);\n    return {\n      post: post\n    , cleanup: cleanup\n    , loaded: unattach\n    };\n  }\n};\n\nmodule.exports.iframeEnabled = false;\nif (global.document) {\n  // postMessage misbehaves in konqueror 4.6.5 - the messages are delivered with\n  // huge delay, or not at all.\n  module.exports.iframeEnabled = (typeof global.postMessage === 'function' ||\n    typeof global.postMessage === 'object') && (!browser.isKonqueror());\n}\n"]}