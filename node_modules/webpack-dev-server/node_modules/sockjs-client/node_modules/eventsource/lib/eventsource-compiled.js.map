{"version":3,"sources":["eventsource.js"],"names":[],"mappings":"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","file":"eventsource-compiled.js","sourcesContent":["var original = require('original')\n  , parse = require('url').parse\n  , events = require('events')\n  , https = require('https')\n  , http = require('http')\n  , util = require('util');\n\nfunction isPlainObject(obj) {\n  return Object.getPrototypeOf(obj) === Object.prototype;\n}\n\n/**\n * Creates a new EventSource object\n *\n * @param {String} url the URL to which to connect\n * @param {Object} eventSourceInitDict extra init params. See README for details.\n * @api public\n **/\nfunction EventSource(url, eventSourceInitDict) {\n  var readyState = EventSource.CONNECTING;\n  Object.defineProperty(this, 'readyState', {\n    get: function () {\n      return readyState;\n    }\n  });\n\n  Object.defineProperty(this, 'url', {\n    get: function () {\n      return url;\n    }\n  });\n\n  var self = this;\n  self.reconnectInterval = 1000;\n  var connectPending = false;\n\n  function onConnectionClosed() {\n    if (connectPending || readyState === EventSource.CLOSED) return;\n    connectPending = true;\n    readyState = EventSource.CONNECTING;\n    _emit('error', new Event('error'));\n\n    // The url may have been changed by a temporary\n    // redirect. If that's the case, revert it now.\n    if (reconnectUrl) {\n      url = reconnectUrl;\n      reconnectUrl = null;\n    }\n    setTimeout(function () {\n      if (readyState !== EventSource.CONNECTING) {\n        return;\n      }\n      connect();\n    }, self.reconnectInterval);\n  }\n\n  var req;\n  var lastEventId = '';\n  if (eventSourceInitDict && eventSourceInitDict.headers && isPlainObject(eventSourceInitDict.headers) && eventSourceInitDict.headers['Last-Event-ID']) {\n    lastEventId = eventSourceInitDict.headers['Last-Event-ID'];\n    delete eventSourceInitDict.headers['Last-Event-ID'];\n  }\n\n  var discardTrailingNewline = false\n    , data = ''\n    , eventName = '';\n\n  var reconnectUrl = null;\n\n  function connect() {\n    connectPending = false;\n\n    var options = parse(url);\n    var isSecure = options.protocol == 'https:';\n    options.headers = { 'Cache-Control': 'no-cache', 'Accept': 'text/event-stream' };\n    if (lastEventId) options.headers['Last-Event-ID'] = lastEventId;\n    if (eventSourceInitDict && eventSourceInitDict.headers && isPlainObject(eventSourceInitDict.headers)) {\n      for (var i in eventSourceInitDict.headers) {\n        var header = eventSourceInitDict.headers[i];\n        if (header) {\n          options.headers[i] = header;\n        }\n      }\n    }\n\n    options.rejectUnauthorized = !(eventSourceInitDict && eventSourceInitDict.rejectUnauthorized == false);\n\n    req = (isSecure ? https : http).request(options, function (res) {\n      // Handle HTTP redirects\n      if (res.statusCode == 301 || res.statusCode == 307) {\n        if (!res.headers.location) {\n          // Server sent redirect response without Location header.\n          _emit('error', new Event('error', {status: res.statusCode}));\n          return;\n        }\n        if (res.statusCode == 307) reconnectUrl = url;\n        url = res.headers.location;\n        process.nextTick(connect);\n        return;\n      }\n\n      if (res.statusCode !== 200) {\n        _emit('error', new Event('error', {status: res.statusCode}));\n        return self.close();\n      }\n\n      readyState = EventSource.OPEN;\n      res.on('close', onConnectionClosed);\n      res.on('end', onConnectionClosed);\n      _emit('open', new Event('open'));\n\n      // text/event-stream parser adapted from webkit's\n      // Source/WebCore/page/EventSource.cpp\n      var buf = '';\n      res.on('data', function (chunk) {\n        buf += chunk;\n\n        var pos = 0\n          , length = buf.length;\n        while (pos < length) {\n          if (discardTrailingNewline) {\n            if (buf[pos] === '\\n') {\n              ++pos;\n            }\n            discardTrailingNewline = false;\n          }\n\n          var lineLength = -1\n            , fieldLength = -1\n            , c;\n\n          for (var i = pos; lineLength < 0 && i < length; ++i) {\n            c = buf[i];\n            if (c === ':') {\n              if (fieldLength < 0) {\n                fieldLength = i - pos;\n              }\n            } else if (c === '\\r') {\n              discardTrailingNewline = true;\n              lineLength = i - pos;\n            } else if (c === '\\n') {\n              lineLength = i - pos;\n            }\n          }\n\n          if (lineLength < 0) {\n            break;\n          }\n\n          parseEventStreamLine(buf, pos, fieldLength, lineLength);\n\n          pos += lineLength + 1;\n        }\n\n        if (pos === length) {\n          buf = '';\n        } else if (pos > 0) {\n          buf = buf.slice(pos);\n        }\n      });\n    });\n\n    req.on('error', onConnectionClosed);\n    req.setNoDelay(true);\n    req.end();\n  }\n\n  connect();\n\n  function _emit() {\n    if (self.listeners(arguments[0]).length > 0) {\n      self.emit.apply(self, arguments);\n    }\n  }\n\n  this.close = function () {\n    if (readyState == EventSource.CLOSED) return;\n    readyState = EventSource.CLOSED;\n    req.abort();\n  };\n\n  function parseEventStreamLine(buf, pos, fieldLength, lineLength) {\n    if (lineLength === 0) {\n      if (data.length > 0) {\n        var type = eventName || 'message';\n        _emit(type, new MessageEvent(type, {\n          data: data.slice(0, -1), // remove trailing newline\n          lastEventId: lastEventId,\n          origin: original(url)\n        }));\n        data = '';\n      }\n      eventName = void 0;\n    } else if (fieldLength > 0) {\n      var noValue = fieldLength < 0\n        , step = 0\n        , field = buf.slice(pos, pos + (noValue ? lineLength : fieldLength));\n\n      if (noValue) {\n        step = lineLength;\n      } else if (buf[pos + fieldLength + 1] !== ' ') {\n        step = fieldLength + 1;\n      } else {\n        step = fieldLength + 2;\n      }\n      pos += step;\n      var valueLength = lineLength - step\n        , value = buf.slice(pos, pos + valueLength);\n\n      if (field === 'data') {\n        data += value + '\\n';\n      } else if (field === 'event') {\n        eventName = value;\n      } else if (field === 'id') {\n        lastEventId = value;\n      } else if (field === 'retry') {\n        var retry = parseInt(value, 10);\n        if (!Number.isNaN(retry)) {\n          self.reconnectInterval = retry;\n        }\n      }\n    }\n  }\n}\n\nmodule.exports = EventSource;\n\nutil.inherits(EventSource, events.EventEmitter);\nEventSource.prototype.constructor = EventSource; // make stacktraces readable\n\n['open', 'error', 'message'].forEach(function (method) {\n  Object.defineProperty(EventSource.prototype, 'on' + method, {\n    /**\n     * Returns the current listener\n     *\n     * @return {Mixed} the set function or undefined\n     * @api private\n     */\n    get: function get() {\n      var listener = this.listeners(method)[0];\n      return listener ? (listener._listener ? listener._listener : listener) : undefined;\n    },\n\n    /**\n     * Start listening for events\n     *\n     * @param {Function} listener the listener\n     * @return {Mixed} the set function or undefined\n     * @api private\n     */\n    set: function set(listener) {\n      this.removeAllListeners(method);\n      this.addEventListener(method, listener);\n    }\n  });\n});\n\n/**\n * Ready states\n */\nObject.defineProperty(EventSource, 'CONNECTING', { enumerable: true, value: 0});\nObject.defineProperty(EventSource, 'OPEN', { enumerable: true, value: 1});\nObject.defineProperty(EventSource, 'CLOSED', { enumerable: true, value: 2});\n\n/**\n * Emulates the W3C Browser based WebSocket interface using addEventListener.\n *\n * @param {String} method Listen for an event\n * @param {Function} listener callback\n * @see https://developer.mozilla.org/en/DOM/element.addEventListener\n * @see http://dev.w3.org/html5/websockets/#the-websocket-interface\n * @api public\n */\nEventSource.prototype.addEventListener = function addEventListener(method, listener) {\n  if (typeof listener === 'function') {\n    // store a reference so we can return the original function again\n    listener._listener = listener;\n    this.on(method, listener);\n  }\n};\n\n/**\n * W3C Event\n *\n * @see http://www.w3.org/TR/DOM-Level-3-Events/#interface-Event\n * @api private\n */\nfunction Event(type, optionalProperties) {\n  Object.defineProperty(this, 'type', { writable: false, value: type, enumerable: true });\n  if (optionalProperties) {\n    for (var f in optionalProperties) {\n      if (optionalProperties.hasOwnProperty(f)) {\n        Object.defineProperty(this, f, { writable: false, value: optionalProperties[f], enumerable: true });\n      }\n    }\n  }\n}\n\n/**\n * W3C MessageEvent\n *\n * @see http://www.w3.org/TR/webmessaging/#event-definitions\n * @api private\n */\nfunction MessageEvent(type, eventInitDict) {\n  Object.defineProperty(this, 'type', { writable: false, value: type, enumerable: true });\n  for (var f in eventInitDict) {\n    if (eventInitDict.hasOwnProperty(f)) {\n      Object.defineProperty(this, f, { writable: false, value: eventInitDict[f], enumerable: true });\n    }\n  }\n}\n"]}