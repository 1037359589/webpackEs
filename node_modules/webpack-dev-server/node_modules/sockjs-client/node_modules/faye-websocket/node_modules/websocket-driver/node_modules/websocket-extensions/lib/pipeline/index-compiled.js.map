{"version":3,"sources":["index.js"],"names":[],"mappings":"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","file":"index-compiled.js","sourcesContent":["'use strict';\n\nvar Cell   = require('./cell'),\n    Pledge = require('./pledge');\n\nvar Pipeline = function(sessions) {\n  this._cells   = sessions.map(function(session) { return new Cell(session) });\n  this._stopped = {incoming: false, outgoing: false};\n};\n\nPipeline.prototype.processIncomingMessage = function(message, callback, context) {\n  if (this._stopped.incoming) return;\n  this._loop('incoming', this._cells.length - 1, -1, -1, message, callback, context);\n};\n\nPipeline.prototype.processOutgoingMessage = function(message, callback, context) {\n  if (this._stopped.outgoing) return;\n  this._loop('outgoing', 0, this._cells.length, 1, message, callback, context);\n};\n\nPipeline.prototype.close = function(callback, context) {\n  this._stopped = {incoming: true, outgoing: true};\n\n  var closed = this._cells.map(function(a) { return a.close() });\n  if (callback)\n    Pledge.all(closed).then(function() { callback.call(context) });\n};\n\nPipeline.prototype._loop = function(direction, start, end, step, message, callback, context) {\n  var cells = this._cells,\n      n     = cells.length,\n      self  = this;\n\n  while (n--) cells[n].pending(direction);\n\n  var pipe = function(index, error, msg) {\n    if (index === end) return callback.call(context, error, msg);\n\n    cells[index][direction](error, msg, function(err, m) {\n      if (err) self._stopped[direction] = true;\n      pipe(index + step, err, m);\n    });\n  };\n  pipe(start, null, message);\n};\n\nmodule.exports = Pipeline;\n"]}