{"version":3,"sources":["pledge.js"],"names":[],"mappings":"AAAA,YAAY,CAAC;;AAEb,IAAI,UAAU,GAAG,OAAO,CAAC,eAAe,CAAC,CAAC;;AAE1C,IAAI,MAAM,GAAG,YAAW;AACtB,MAAI,CAAC,SAAS,GAAI,KAAK,CAAC;AACxB,MAAI,CAAC,UAAU,GAAG,IAAI,UAAU,CAAC,MAAM,CAAC,UAAU,CAAC,CAAC;CACrD,CAAC;;AAEF,MAAM,CAAC,UAAU,GAAG,CAAC,CAAC;;AAEtB,MAAM,CAAC,GAAG,GAAG,UAAS,IAAI,EAAE;AAC1B,MAAI,MAAM,GAAI,IAAI,MAAM,EAAE;MACtB,OAAO,GAAG,IAAI,CAAC,MAAM;MACrB,CAAC,GAAS,OAAO,CAAC;;AAEtB,MAAI,OAAO,KAAK,CAAC,EAAE,MAAM,CAAC,IAAI,EAAE,CAAC;;AAEjC,SAAO,CAAC,EAAE,EAAE,IAAI,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,YAAW;AAClC,WAAO,IAAI,CAAC,CAAC;AACb,QAAI,OAAO,KAAK,CAAC,EAAE,MAAM,CAAC,IAAI,EAAE,CAAC;GAClC,CAAC,CAAC;AACH,SAAO,MAAM,CAAC;CACf,CAAC;;AAEF,MAAM,CAAC,SAAS,CAAC,IAAI,GAAG,UAAS,QAAQ,EAAE;AACzC,MAAI,IAAI,CAAC,SAAS,EAAE,QAAQ,EAAE,CAAC,KAC1B,IAAI,CAAC,UAAU,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;CACrC,CAAC;;AAEF,MAAM,CAAC,SAAS,CAAC,IAAI,GAAG,YAAW;AACjC,MAAI,CAAC,SAAS,GAAG,IAAI,CAAC;AACtB,MAAI,SAAS,GAAG,IAAI,CAAC,UAAU;MAAE,QAAQ,CAAC;AAC1C,SAAO,QAAQ,GAAG,SAAS,CAAC,KAAK,EAAE,EAAE,QAAQ,EAAE,CAAC;CACjD,CAAC;;AAEF,MAAM,CAAC,OAAO,GAAG,MAAM,CAAC","file":"pledge-compiled.js","sourcesContent":["'use strict';\n\nvar RingBuffer = require('./ring_buffer');\n\nvar Pledge = function() {\n  this._complete  = false;\n  this._callbacks = new RingBuffer(Pledge.QUEUE_SIZE);\n};\n\nPledge.QUEUE_SIZE = 4;\n\nPledge.all = function(list) {\n  var pledge  = new Pledge(),\n      pending = list.length,\n      n       = pending;\n\n  if (pending === 0) pledge.done();\n\n  while (n--) list[n].then(function() {\n    pending -= 1;\n    if (pending === 0) pledge.done();\n  });\n  return pledge;\n};\n\nPledge.prototype.then = function(callback) {\n  if (this._complete) callback();\n  else this._callbacks.push(callback);\n};\n\nPledge.prototype.done = function() {\n  this._complete = true;\n  var callbacks = this._callbacks, callback;\n  while (callback = callbacks.shift()) callback();\n};\n\nmodule.exports = Pledge;\n"]}