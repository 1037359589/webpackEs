{"version":3,"sources":["client.js"],"names":[],"mappings":"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","file":"client-compiled.js","sourcesContent":["var util   = require('util'),\n    net    = require('net'),\n    tls    = require('tls'),\n    crypto = require('crypto'),\n    url    = require('url'),\n    driver = require('websocket-driver'),\n    API    = require('./api'),\n    Event  = require('./api/event');\n\nvar DEFAULT_PORTS    = {'http:': 80, 'https:': 443, 'ws:':80, 'wss:': 443},\n    SECURE_PROTOCOLS = ['https:', 'wss:'];\n\nvar Client = function(_url, protocols, options) {\n  options = options || {};\n\n  this.url     = _url;\n  this._driver = driver.client(this.url, {maxLength: options.maxLength, protocols: protocols});\n\n  ['open', 'error'].forEach(function(event) {\n    this._driver.on(event, function() {\n      self.headers    = self._driver.headers;\n      self.statusCode = self._driver.statusCode;\n    });\n  }, this);\n\n  var proxy     = options.proxy || {},\n      endpoint  = url.parse(proxy.origin || this.url),\n      port      = endpoint.port || DEFAULT_PORTS[endpoint.protocol],\n      secure    = SECURE_PROTOCOLS.indexOf(endpoint.protocol) >= 0,\n      onConnect = function() { self._onConnect() },\n      originTLS = options.tls || {},\n      socketTLS = proxy.origin ? (proxy.tls || {}) : originTLS,\n      self      = this;\n\n  originTLS.ca = originTLS.ca || options.ca;\n\n  this._stream = secure\n               ? tls.connect(port, endpoint.hostname, socketTLS, onConnect)\n               : net.connect(port, endpoint.hostname, onConnect);\n\n  if (proxy.origin) this._configureProxy(proxy, originTLS);\n\n  API.call(this, options);\n};\nutil.inherits(Client, API);\n\nClient.prototype._onConnect = function() {\n  var worker = this._proxy || this._driver;\n  worker.start();\n};\n\nClient.prototype._configureProxy = function(proxy, originTLS) {\n  var uri    = url.parse(this.url),\n      secure = SECURE_PROTOCOLS.indexOf(uri.protocol) >= 0,\n      self   = this,\n      name;\n\n  this._proxy = this._driver.proxy(proxy.origin);\n\n  if (proxy.headers) {\n    for (name in proxy.headers) this._proxy.setHeader(name, proxy.headers[name]);\n  }\n\n  this._proxy.pipe(this._stream, {end: false});\n  this._stream.pipe(this._proxy);\n\n  this._proxy.on('connect', function() {\n    if (secure) {\n      var options = {socket: self._stream, servername: uri.hostname};\n      for (name in originTLS) options[name] = originTLS[name];\n      self._stream = tls.connect(options);\n      self._configureStream();\n    }\n    self._driver.io.pipe(self._stream);\n    self._stream.pipe(self._driver.io);\n    self._driver.start();\n  });\n\n  this._proxy.on('error', function(error) {\n    self._driver.emit('error', error);\n  });\n};\n\nmodule.exports = Client;\n"]}