{"version":3,"sources":["client.js"],"names":[],"mappings":"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","file":"client-compiled.js","sourcesContent":["'use strict';\n\nvar crypto     = require('crypto'),\n    url        = require('url'),\n    util       = require('util'),\n    HttpParser = require('../http_parser'),\n    Base       = require('./base'),\n    Hybi       = require('./hybi'),\n    Proxy      = require('./proxy');\n\nvar Client = function(_url, options) {\n  this.version = 'hybi-13';\n  Hybi.call(this, null, _url, options);\n\n  this.readyState = -1;\n  this._key       = Client.generateKey();\n  this._accept    = Hybi.generateAccept(this._key);\n  this._http      = new HttpParser('response');\n\n  var uri  = url.parse(this.url),\n      auth = uri.auth && new Buffer(uri.auth, 'utf8').toString('base64');\n\n  if (this.VALID_PROTOCOLS.indexOf(uri.protocol) < 0)\n    throw new Error(this.url + ' is not a valid WebSocket URL');\n\n  this._pathname = (uri.pathname || '/') + (uri.search || '');\n\n  this._headers.set('Host', uri.host);\n  this._headers.set('Upgrade', 'websocket');\n  this._headers.set('Connection', 'Upgrade');\n  this._headers.set('Sec-WebSocket-Key', this._key);\n  this._headers.set('Sec-WebSocket-Version', '13');\n\n  if (this._protocols.length > 0)\n    this._headers.set('Sec-WebSocket-Protocol', this._protocols.join(', '));\n\n  if (auth)\n    this._headers.set('Authorization', 'Basic ' + auth);\n};\nutil.inherits(Client, Hybi);\n\nClient.generateKey = function() {\n  return crypto.randomBytes(16).toString('base64');\n};\n\nvar instance = {\n  VALID_PROTOCOLS: ['ws:', 'wss:'],\n\n  proxy: function(origin, options) {\n    return new Proxy(this, origin, options);\n  },\n\n  start: function() {\n    if (this.readyState !== -1) return false;\n    this._write(this._handshakeRequest());\n    this.readyState = 0;\n    return true;\n  },\n\n  parse: function(chunk) {\n    if (this.readyState === 3) return;\n    if (this.readyState > 0) return Hybi.prototype.parse.call(this, chunk);\n\n    this._http.parse(chunk);\n    if (!this._http.isComplete()) return;\n\n    this._validateHandshake();\n    if (this.readyState === 3) return;\n\n    this._open();\n    this.parse(this._http.body);\n  },\n\n  _handshakeRequest: function() {\n    var extensions = this._extensions.generateOffer();\n    if (extensions)\n      this._headers.set('Sec-WebSocket-Extensions', extensions);\n\n    var start   = 'GET ' + this._pathname + ' HTTP/1.1',\n        headers = [start, this._headers.toString(), ''];\n\n    return new Buffer(headers.join('\\r\\n'), 'utf8');\n  },\n\n  _failHandshake: function(message) {\n    message = 'Error during WebSocket handshake: ' + message;\n    this.readyState = 3;\n    this.emit('error', new Error(message));\n    this.emit('close', new Base.CloseEvent(this.ERRORS.protocol_error, message));\n  },\n\n  _validateHandshake: function() {\n    this.statusCode = this._http.statusCode;\n    this.headers    = this._http.headers;\n\n    if (this._http.statusCode !== 101)\n      return this._failHandshake('Unexpected response code: ' + this._http.statusCode);\n\n    var headers    = this._http.headers,\n        upgrade    = headers['upgrade'] || '',\n        connection = headers['connection'] || '',\n        accept     = headers['sec-websocket-accept'] || '',\n        protocol   = headers['sec-websocket-protocol'] || '';\n\n    if (upgrade === '')\n      return this._failHandshake(\"'Upgrade' header is missing\");\n    if (upgrade.toLowerCase() !== 'websocket')\n      return this._failHandshake(\"'Upgrade' header value is not 'WebSocket'\");\n\n    if (connection === '')\n      return this._failHandshake(\"'Connection' header is missing\");\n    if (connection.toLowerCase() !== 'upgrade')\n      return this._failHandshake(\"'Connection' header value is not 'Upgrade'\");\n\n    if (accept !== this._accept)\n      return this._failHandshake('Sec-WebSocket-Accept mismatch');\n\n    this.protocol = null;\n\n    if (protocol !== '') {\n      if (this._protocols.indexOf(protocol) < 0)\n        return this._failHandshake('Sec-WebSocket-Protocol mismatch');\n      else\n        this.protocol = protocol;\n    }\n\n    try {\n      this._extensions.activate(this.headers['sec-websocket-extensions']);\n    } catch (e) {\n      return this._failHandshake(e.message);\n    }\n  }\n};\n\nfor (var key in instance)\n  Client.prototype[key] = instance[key];\n\nmodule.exports = Client;\n"]}