{"version":3,"sources":["proxy.js"],"names":[],"mappings":"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","file":"proxy-compiled.js","sourcesContent":["'use strict';\n\nvar Stream     = require('stream').Stream,\n    url        = require('url'),\n    util       = require('util'),\n    Base       = require('./base'),\n    Headers    = require('./headers'),\n    HttpParser = require('../http_parser');\n\nvar PORTS = {'ws:': 80, 'wss:': 443};\n\nvar Proxy = function(client, origin, options) {\n  this._client  = client;\n  this._http    = new HttpParser('response');\n  this._origin  = (typeof client.url === 'object') ? client.url : url.parse(client.url);\n  this._url     = (typeof origin === 'object') ? origin : url.parse(origin);\n  this._options = options || {};\n  this._state   = 0;\n\n  this.readable = this.writable = true;\n  this._paused  = false;\n\n  this._headers = new Headers();\n  this._headers.set('Host', this._origin.host);\n  this._headers.set('Connection', 'keep-alive');\n  this._headers.set('Proxy-Connection', 'keep-alive');\n\n  var auth = this._url.auth && new Buffer(this._url.auth, 'utf8').toString('base64');\n  if (auth) this._headers.set('Proxy-Authorization', 'Basic ' + auth);\n};\nutil.inherits(Proxy, Stream);\n\nvar instance = {\n  setHeader: function(name, value) {\n    if (this._state !== 0) return false;\n    this._headers.set(name, value);\n    return true;\n  },\n\n  start: function() {\n    if (this._state !== 0) return false;\n    this._state = 1;\n\n    var origin = this._origin,\n        port   = origin.port || PORTS[origin.protocol],\n        start  = 'CONNECT ' + origin.hostname + ':' + port + ' HTTP/1.1';\n\n    var headers = [start, this._headers.toString(), ''];\n\n    this.emit('data', new Buffer(headers.join('\\r\\n'), 'utf8'));\n    return true;\n  },\n\n  pause: function() {\n    this._paused = true;\n  },\n\n  resume: function() {\n    this._paused = false;\n    this.emit('drain');\n  },\n\n  write: function(chunk) {\n    if (!this.writable) return false;\n\n    this._http.parse(chunk);\n    if (!this._http.isComplete()) return !this._paused;\n\n    this.statusCode = this._http.statusCode;\n    this.headers    = this._http.headers;\n\n    if (this.statusCode === 200) {\n      this.emit('connect', new Base.ConnectEvent());\n    } else {\n      var message = \"Can't establish a connection to the server at \" + this._origin.href;\n      this.emit('error', new Error(message));\n    }\n    this.end();\n    return !this._paused;\n  },\n\n  end: function(chunk) {\n    if (!this.writable) return;\n    if (chunk !== undefined) this.write(chunk);\n    this.readable = this.writable = false;\n    this.emit('close');\n    this.emit('end');\n  },\n\n  destroy: function() {\n    this.end();\n  }\n};\n\nfor (var key in instance)\n  Proxy.prototype[key] = instance[key];\n\nmodule.exports = Proxy;\n"]}