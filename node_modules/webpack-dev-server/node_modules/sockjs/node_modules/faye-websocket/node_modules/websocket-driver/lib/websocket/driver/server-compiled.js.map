{"version":3,"sources":["server.js"],"names":[],"mappings":"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","file":"server-compiled.js","sourcesContent":["'use strict';\n\nvar util       = require('util'),\n    HttpParser = require('../http_parser'),\n    Base       = require('./base'),\n    Draft75    = require('./draft75'),\n    Draft76    = require('./draft76'),\n    Hybi       = require('./hybi');\n\nvar Server = function(options) {\n  Base.call(this, null, null, options);\n  this._http = new HttpParser('request');\n};\nutil.inherits(Server, Base);\n\nvar instance = {\n  EVENTS: ['open', 'message', 'error', 'close'],\n\n  _bindEventListeners: function() {\n    this.messages.on('error', function() {});\n    this.on('error', function() {});\n  },\n\n  parse: function(chunk) {\n    if (this._delegate) return this._delegate.parse(chunk);\n\n    this._http.parse(chunk);\n    if (!this._http.isComplete()) return;\n\n    this.method  = this._http.method;\n    this.url     = this._http.url;\n    this.headers = this._http.headers;\n    this.body    = this._http.body;\n\n    var self = this;\n    this._delegate = Server.http(this, this._options);\n    this._delegate.messages = this.messages;\n    this._delegate.io = this.io;\n    this._open();\n\n    this.EVENTS.forEach(function(event) {\n      this._delegate.on(event, function(e) { self.emit(event, e) });\n    }, this);\n\n    this.protocol = this._delegate.protocol;\n    this.version  = this._delegate.version;\n\n    this.parse(this._http.body);\n    this.emit('connect', new Base.ConnectEvent());\n  },\n\n  _open: function() {\n    this.__queue.forEach(function(msg) {\n      this._delegate[msg[0]].apply(this._delegate, msg[1]);\n    }, this);\n    this.__queue = [];\n  }\n};\n\n['addExtension', 'setHeader', 'start', 'frame', 'text', 'binary', 'ping', 'close'].forEach(function(method) {\n  instance[method] = function() {\n    if (this._delegate) {\n      return this._delegate[method].apply(this._delegate, arguments);\n    } else {\n      this.__queue.push([method, arguments]);\n      return true;\n    }\n  };\n});\n\nfor (var key in instance)\n  Server.prototype[key] = instance[key];\n\nServer.isSecureRequest = function(request) {\n  if (request.connection && request.connection.authorized !== undefined) return true;\n  if (request.socket && request.socket.secure) return true;\n\n  var headers = request.headers;\n  if (!headers) return false;\n  if (headers['https'] === 'on') return true;\n  if (headers['x-forwarded-ssl'] === 'on') return true;\n  if (headers['x-forwarded-scheme'] === 'https') return true;\n  if (headers['x-forwarded-proto'] === 'https') return true;\n\n  return false;\n};\n\nServer.determineUrl = function(request) {\n  var scheme = this.isSecureRequest(request) ? 'wss:' : 'ws:';\n  return scheme + '//' + request.headers.host + request.url;\n};\n\nServer.http = function(request, options) {\n  options = options || {};\n  if (options.requireMasking === undefined) options.requireMasking = true;\n\n  var headers = request.headers,\n      url     = this.determineUrl(request);\n\n  if (headers['sec-websocket-version'])\n    return new Hybi(request, url, options);\n  else if (headers['sec-websocket-key1'])\n    return new Draft76(request, url, options);\n  else\n    return new Draft75(request, url, options);\n};\n\nmodule.exports = Server;\n"]}