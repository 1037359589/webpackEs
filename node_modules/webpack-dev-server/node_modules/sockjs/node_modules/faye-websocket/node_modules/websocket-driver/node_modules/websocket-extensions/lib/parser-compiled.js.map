{"version":3,"sources":["parser.js"],"names":[],"mappings":"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","file":"parser-compiled.js","sourcesContent":["'use strict';\n\nvar TOKEN    = /([!#\\$%&'\\*\\+\\-\\.\\^_`\\|~0-9a-z]+)/,\n    NOTOKEN  = /([^!#\\$%&'\\*\\+\\-\\.\\^_`\\|~0-9a-z])/g,\n    QUOTED   = /\"((?:\\\\[\\x00-\\x7f]|[^\\x00-\\x08\\x0a-\\x1f\\x7f\"])*)\"/,\n    PARAM    = new RegExp(TOKEN.source + '(?:=(?:' + TOKEN.source + '|' + QUOTED.source + '))?'),\n    EXT      = new RegExp(TOKEN.source + '(?: *; *' + PARAM.source + ')*', 'g'),\n    EXT_LIST = new RegExp('^' + EXT.source + '(?: *, *' + EXT.source + ')*$'),\n    NUMBER   = /^-?(0|[1-9][0-9]*)(\\.[0-9]+)?$/;\n\nvar Parser = {\n  parseHeader: function(header) {\n    var offers = new Offers();\n    if (header === '' || header === undefined) return offers;\n\n    if (!EXT_LIST.test(header))\n      throw new SyntaxError('Invalid Sec-WebSocket-Extensions header: ' + header);\n\n    var values = header.match(EXT);\n\n    values.forEach(function(value) {\n      var params = value.match(new RegExp(PARAM.source, 'g')),\n          name   = params.shift(),\n          offer  = {};\n\n      params.forEach(function(param) {\n        var args = param.match(PARAM), key = args[1], data;\n\n        if (args[2] !== undefined) {\n          data = args[2];\n        } else if (args[3] !== undefined) {\n          data = args[3].replace(/\\\\/g, '');\n        } else {\n          data = true;\n        }\n        if (NUMBER.test(data)) data = parseFloat(data);\n\n        if (offer.hasOwnProperty(key)) {\n          offer[key] = [].concat(offer[key]);\n          offer[key].push(data);\n        } else {\n          offer[key] = data;\n        }\n      }, this);\n      offers.push(name, offer);\n    }, this);\n\n    return offers;\n  },\n\n  serializeParams: function(name, params) {\n    var values = [];\n\n    var print = function(key, value) {\n      if (value instanceof Array) {\n        value.forEach(function(v) { print(key, v) });\n      } else if (value === true) {\n        values.push(key);\n      } else if (typeof value === 'number') {\n        values.push(key + '=' + value);\n      } else if (NOTOKEN.test(value)) {\n        values.push(key + '=\"' + value.replace(/\"/g, '\\\\\"') + '\"');\n      } else {\n        values.push(key + '=' + value);\n      }\n    };\n\n    for (var key in params) print(key, params[key]);\n\n    return [name].concat(values).join('; ');\n  }\n};\n\nvar Offers = function() {\n  this._byName  = {};\n  this._inOrder = [];\n};\n\nOffers.prototype.push = function(name, params) {\n  this._byName[name] = this._byName[name] || [];\n  this._byName[name].push(params);\n  this._inOrder.push({name: name, params: params});\n};\n\nOffers.prototype.eachOffer = function(callback, context) {\n  var list = this._inOrder;\n  for (var i = 0, n = list.length; i < n; i++)\n    callback.call(context, list[i].name, list[i].params);\n};\n\nOffers.prototype.byName = function(name) {\n  return this._byName[name] || [];\n};\n\nOffers.prototype.toArray = function() {\n  return this._inOrder.slice();\n};\n\nmodule.exports = Parser;\n"]}