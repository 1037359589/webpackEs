{"version":3,"sources":["middleware.js"],"names":[],"mappings":"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","file":"middleware-compiled.js","sourcesContent":["/*\r\n\tMIT License http://www.opensource.org/licenses/mit-license.php\r\n\tAuthor Tobias Koppers @sokra\r\n*/\r\nvar path = require(\"path\");\r\nvar MemoryFileSystem = require(\"memory-fs\");\r\nvar mime = require(\"mime\");\r\n\r\n// constructor for the middleware\r\nmodule.exports = function(compiler, options) {\r\n\tif(!options) options = {};\r\n\tif(typeof options.watchOptions === \"undefined\") options.watchOptions = {};\r\n\tif(typeof options.watchDelay !== \"undefined\") {\r\n\t\t// TODO remove this in next major version\r\n\t\tconsole.warn(\"options.watchDelay is deprecated: Use 'options.watchOptions.aggregateTimeout' instead\");\r\n\t\toptions.watchOptions.aggregateTimeout = options.watchDelay;\r\n\t}\r\n\tif(typeof options.watchOptions.aggregateTimeout === \"undefined\") options.watchOptions.aggregateTimeout = 200;\r\n\tif(typeof options.stats === \"undefined\") options.stats = {};\r\n\tif(!options.stats.context) options.stats.context = process.cwd();\r\n\tif(options.lazy) {\r\n\t\tif(typeof options.filename === \"string\") {\r\n\t\t\tvar str = options.filename\r\n\t\t\t\t.replace(/[\\-\\[\\]\\/\\{\\}\\(\\)\\*\\+\\?\\.\\\\\\^\\$\\|]/g, \"\\\\$&\")\r\n\t\t\t\t.replace(/\\\\\\[[a-z]+\\\\\\]/ig, \".+\");\r\n\t\t\toptions.filename = new RegExp(\"^\" + str + \"$\");\r\n\t\t}\r\n\t}\r\n\r\n\t// store our files in memory\r\n\tvar files = {};\r\n\tvar fs = compiler.outputFileSystem = new MemoryFileSystem();\r\n\r\n\tcompiler.plugin(\"done\", function(stats) {\r\n\t\t// We are now on valid state\r\n\t\tstate = true;\r\n\t\t// Do the stuff in nextTick, because bundle may be invalidated\r\n\t\t//  if a change happend while compiling\r\n\t\tprocess.nextTick(function() {\r\n\t\t\t// check if still in valid state\r\n\t\t\tif(!state) return;\r\n\t\t\t// print webpack output\r\n\t\t\tvar displayStats = (!options.quiet && options.stats !== false);\r\n\t\t\tif(displayStats &&\r\n\t\t\t\t!(stats.hasErrors() || stats.hasWarnings()) &&\r\n\t\t\t\toptions.noInfo)\r\n\t\t\t\tdisplayStats = false;\r\n\t\t\tif(displayStats) {\r\n\t\t\t\tconsole.log(stats.toString(options.stats));\r\n\t\t\t}\r\n\t\t\tif (!options.noInfo && !options.quiet)\r\n\t\t\t\tconsole.info(\"webpack: bundle is now VALID.\");\r\n\r\n\t\t\t// execute callback that are delayed\r\n\t\t\tvar cbs = callbacks;\r\n\t\t\tcallbacks = [];\r\n\t\t\tcbs.forEach(function continueBecauseBundleAvailible(cb) {\r\n\t\t\t\tcb();\r\n\t\t\t});\r\n\t\t});\r\n\r\n\t\t// In lazy mode, we may issue another rebuild\r\n\t\tif(forceRebuild) {\r\n\t\t\tforceRebuild = false;\r\n\t\t\trebuild();\r\n\t\t}\r\n\t});\r\n\r\n\t// on compiling\r\n\tfunction invalidPlugin() {\r\n\t\tif(state && (!options.noInfo && !options.quiet))\r\n\t\t\tconsole.info(\"webpack: bundle is now INVALID.\");\r\n\t\t// We are now in invalid state\r\n\t\tstate = false;\r\n\t}\r\n\tfunction invalidAsyncPlugin(compiler, callback) {\r\n\t\tinvalidPlugin();\r\n\t\tcallback();\r\n\t}\r\n\tcompiler.plugin(\"invalid\", invalidPlugin);\r\n\tcompiler.plugin(\"watch-run\", invalidAsyncPlugin);\r\n\tcompiler.plugin(\"run\", invalidAsyncPlugin);\r\n\r\n\t// the state, false: bundle invalid, true: bundle valid\r\n\tvar state = false;\r\n\r\n\t// in lazy mode, rebuild automatically\r\n\tvar forceRebuild = false;\r\n\r\n\t// delayed callback\r\n\tvar callbacks = [];\r\n\r\n\t// wait for bundle valid\r\n\tfunction ready(fn, req) {\r\n\t\tif(state) return fn();\r\n\t\tif(!options.noInfo && !options.quiet)\r\n\t\t\tconsole.log(\"webpack: wait until bundle finished: \" + req.url);\r\n\t\tcallbacks.push(fn);\r\n\t}\r\n\r\n\t// start watching\r\n\tif(!options.lazy) {\r\n\t\tvar watching = compiler.watch(options.watchOptions, function(err) {\r\n\t\t\tif(err) throw err;\r\n\t\t});\r\n\t} else {\r\n\t\tstate = true;\r\n\t}\r\n\r\n\tfunction rebuild() {\r\n\t\tif(state) {\r\n\t\t\tstate = false;\r\n\t\t\tcompiler.run(function(err) {\r\n\t\t\t\tif(err) throw err;\r\n\t\t\t});\r\n\t\t} else {\r\n\t\t\tforceRebuild = true;\r\n\t\t}\r\n\t}\r\n\r\n\tfunction pathJoin(a, b) {\r\n\t\treturn a == \"/\" ? \"/\" + b : (a||\"\") + \"/\" + b\r\n\t}\r\n\r\n\tfunction getFilenameFromUrl(url) {\r\n\t\t// publicPrefix is the folder our bundle should be in\r\n\t\tvar localPrefix = options.publicPath || \"/\";\r\n\t\tif(url.indexOf(localPrefix) !== 0) {\r\n\t\t\tif(/^(https?:)?\\/\\//.test(localPrefix)) {\r\n\t\t\t\tlocalPrefix = \"/\" + localPrefix.replace(/^(https?:)?\\/\\/[^\\/]+\\//, \"\");\r\n\t\t\t\t// fast exit if another directory requested\r\n\t\t\t\tif(url.indexOf(localPrefix) !== 0) return false;\r\n\t\t\t} else return false;\r\n\t\t}\r\n\t\t// get filename from request\r\n\t\tvar filename = url.substr(localPrefix.length);\r\n\t\tif(filename.indexOf(\"?\") >= 0) {\r\n\t\t\tfilename = filename.substr(0, filename.indexOf(\"?\"));\r\n\t\t}\r\n\t\treturn filename ? pathJoin(compiler.outputPath, filename) : compiler.outputPath;\r\n\t}\r\n\r\n\t// The middleware function\r\n\tfunction webpackDevMiddleware(req, res, next) {\r\n\t\tvar filename = getFilenameFromUrl(req.url);\r\n\t\tif (filename === false) return next();\r\n\r\n\t\t// in lazy mode, rebuild on bundle request\r\n\t\tif(options.lazy && (!options.filename || options.filename.test(filename)))\r\n\t\t\trebuild();\r\n\r\n\t\t// delay the request until we have a vaild bundle\r\n\t\tready(function() {\r\n\t\t\ttry {\r\n\t\t\t\tvar stat = fs.statSync(filename);\r\n\t\t\t\tif(!stat.isFile()) {\r\n\t\t\t\t\tif (stat.isDirectory()) {\r\n\t\t\t\t\t\tfilename = path.join(filename, \"index.html\");\r\n\t\t\t\t\t\tstat = fs.statSync(filename);\r\n\t\t\t\t\t\tif(!stat.isFile()) throw \"next\";\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tthrow \"next\";\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t} catch(e) {\r\n\t\t\t\treturn next();\r\n\t\t\t}\r\n\r\n\t\t\t// server content\r\n\t\t\tvar content = fs.readFileSync(filename);\r\n\t\t\tres.setHeader(\"Access-Control-Allow-Origin\", \"*\"); // To support XHR, etc.\r\n\t\t\tres.setHeader(\"Content-Type\", mime.lookup(filename));\r\n\t\t\tres.setHeader(\"Content-Length\", content.length);\r\n\t\t\tif(options.headers) {\r\n\t\t\t\tfor(var name in options.headers) {\r\n\t\t\t\t\tres.setHeader(name, options.headers[name]);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tres.end(content);\r\n\t\t}, req);\r\n\t}\r\n\r\n\twebpackDevMiddleware.getFilenameFromUrl = getFilenameFromUrl;\r\n\r\n\twebpackDevMiddleware.invalidate = function() {\r\n\t\tif(watching) watching.invalidate();\r\n\t};\r\n\twebpackDevMiddleware.close = function(callback) {\r\n\t\tcallback = callback || function(){};\r\n\t\tif(watching) watching.close(callback);\r\n\t\telse callback();\r\n\t};\r\n\r\n\twebpackDevMiddleware.fileSystem = fs;\r\n\r\n\treturn webpackDevMiddleware;\r\n}\r\n"]}